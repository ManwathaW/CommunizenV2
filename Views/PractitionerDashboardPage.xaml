<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="CommuniZEN.Views.PractitionerDashboardPage"
             xmlns:converters="clr-namespace:CommuniZEN.Converters"
             BackgroundColor="#F5F9FF">

    <ContentPage.Resources>

        <converters:Base64ToImageSourceConverter x:Key="Base64ToImageSourceConverter"/>

        <ResourceDictionary>
            <Style x:Key="HeaderLabelStyle" TargetType="Label">
                <Setter Property="TextColor" Value="#2B5C9B"/>
                <Setter Property="FontSize" Value="24"/>
                <Setter Property="FontAttributes" Value="Bold"/>
                <Setter Property="Margin" Value="0,0,0,20"/>
            </Style>

            <Style x:Key="CardStyle" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="White"/>
                <Setter Property="CornerRadius" Value="15"/>
                <Setter Property="HasShadow" Value="True"/>
                <Setter Property="Padding" Value="20"/>
                <Setter Property="Margin" Value="15"/>
                <Setter Property="BorderColor" Value="#E8F0FE"/>
            </Style>

            <Style x:Key="EntryStyle" TargetType="Entry">
                <Setter Property="BackgroundColor" Value="#F8FAFF"/>
                <Setter Property="TextColor" Value="#2B5C9B"/>
                <Setter Property="PlaceholderColor" Value="#95A5A6"/>
                <Setter Property="FontSize" Value="16"/>
                <Setter Property="Margin" Value="0,5,0,15"/>
                <Setter Property="HeightRequest" Value="45"/>
            </Style>

            <Style x:Key="EditorStyle" TargetType="Editor">
                <Setter Property="BackgroundColor" Value="#F8FAFF"/>
                <Setter Property="TextColor" Value="#2B5C9B"/>
                <Setter Property="PlaceholderColor" Value="#95A5A6"/>
                <Setter Property="FontSize" Value="16"/>
                <Setter Property="Margin" Value="0,5,0,15"/>
                <Setter Property="HeightRequest" Value="100"/>
                <Setter Property="AutoSize" Value="TextChanges"/>
            </Style>

            <Style x:Key="ButtonStyle" TargetType="Button">
                <Setter Property="BackgroundColor" Value="#4B89DC"/>
                <Setter Property="TextColor" Value="White"/>
                <Setter Property="FontSize" Value="16"/>
                <Setter Property="CornerRadius" Value="10"/>
                <Setter Property="Padding" Value="20,10"/>
                <Setter Property="Margin" Value="0,5"/>
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>



    <ScrollView>
        <VerticalStackLayout Padding="20">
            <!-- Edit Form - Only visible when IsEditing is true -->
            <VerticalStackLayout IsVisible="{Binding IsEditing}">
                <Label Text="Practitioner Profile" 
                       Style="{StaticResource HeaderLabelStyle}"/>

                <Frame Style="{StaticResource CardStyle}">
                    <VerticalStackLayout Spacing="15">
                        <Frame HeightRequest="120" 
                               WidthRequest="120" 
                               CornerRadius="60"
                               IsClippedToBounds="True"
                               Padding="0"
                               HorizontalOptions="Center"
                               BorderColor="#E8F0FE">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding ChangeProfilePictureCommand}"/>
                            </Frame.GestureRecognizers>
                            <Image Source="{Binding ProfileImage, Converter={StaticResource Base64ToImageSourceConverter}}"
                                   Aspect="AspectFill"
                                   HeightRequest="120"
                                   WidthRequest="120"/>
                        </Frame>

                        <Label Text="Tap to change profile picture"
                               TextColor="#95A5A6"
                               HorizontalOptions="Center"/>

                        <Entry Placeholder="Full Name"
                               Text="{Binding Name}"
                               Style="{StaticResource EntryStyle}"/>

                        <Entry Placeholder="Specialization"
                               Text="{Binding Specialization}"
                               Style="{StaticResource EntryStyle}"/>

                        <Editor Placeholder="Bio (Tell us about yourself and your practice)"
                                Text="{Binding Bio}"
                                Style="{StaticResource EditorStyle}"/>

                        <!-- Add this to your editing section -->
                        <StackLayout Spacing="10" Orientation="Horizontal"  >
                            <Entry HorizontalOptions="FillAndExpand"
                                   Placeholder="Location"
                                   Text="{Binding Location}"
                                   Style="{StaticResource EntryStyle}"
                                   IsReadOnly="True"/>

                            <ImageButton Source="map.png"
                                          Command="{Binding OpenMapPickerCommand}"
                                         HeightRequest="60"
                                         WidthRequest="60"/>

                        </StackLayout>



                        <Button Text="Save Profile"
                                Command="{Binding SaveProfileCommand}"
                                Style="{StaticResource ButtonStyle}"/>

                        <Button Text="Cancel"
                                Command="{Binding CancelEditCommand}"
                                BackgroundColor="#95A5A6"
                                Style="{StaticResource ButtonStyle}"/>
                    </VerticalStackLayout>
                </Frame>
            </VerticalStackLayout>

            <!-- Preview Card - Always visible -->
            <Label Text="Your Profile" 
                   Style="{StaticResource HeaderLabelStyle}"
                   Margin="0,20,0,10"/>

            <Frame Style="{StaticResource CardStyle}">
                <Frame.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding EditProfileCommand}"/>
                </Frame.GestureRecognizers>

                <Grid RowDefinitions="Auto,Auto,Auto" 
                      ColumnDefinitions="Auto,*" 
                      RowSpacing="10">

                    <Frame Grid.RowSpan="3"
                           HeightRequest="80"
                           WidthRequest="80"
                           CornerRadius="40"
                           IsClippedToBounds="True"
                           Padding="0"
                           BorderColor="#E8F0FE">
                        <Image Source="{Binding ProfileImage, Converter={StaticResource Base64ToImageSourceConverter}}"
                               Aspect="AspectFill"/>
                    </Frame>

                    <Label Grid.Column="1"
                           Text="{Binding Name}"
                           TextColor="#2B5C9B"
                           FontAttributes="Bold"
                           FontSize="18"/>

                    <Label Grid.Row="1"
                           Grid.Column="1"
                           Text="{Binding Specialization}"
                           TextColor="#4B89DC"
                           FontSize="14"/>

                    <Label Grid.Row="2"
                           Grid.Column="1"
                           Text="{Binding Bio}"
                           TextColor="#7F98C3"
                           FontSize="14"
                           MaxLines="2"
                           LineBreakMode="TailTruncation"/>
                </Grid>
            </Frame>

            <!-- Delete button below preview card -->
            <Button Text="Delete Profile"
                    Command="{Binding DeleteProfileCommand}"
                    BackgroundColor="#FF6B6B"
                    Style="{StaticResource ButtonStyle}"
                    Margin="0,10,0,0"
                    IsVisible="{Binding HasProfile}"/>
        </VerticalStackLayout>
    </ScrollView>


</ContentPage>