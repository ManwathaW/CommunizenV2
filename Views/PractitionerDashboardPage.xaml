<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:CommuniZEN.Converters"
             x:Class="CommuniZEN.Views.PractitionerDashboardPage"
             BackgroundColor="#F5F9FF">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:Base64ToImageSourceConverter x:Key="Base64ToImageSourceConverter"/>
            <converters:BoolToColorConverter x:Key="BoolToColorConverter" 
                                           />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">
            <!-- Profile Edit Mode -->
            <VerticalStackLayout IsVisible="{Binding IsEditing}">
                <!-- Profile Image Section -->
                <Frame HeightRequest="120" 
                       WidthRequest="120" 
                       CornerRadius="60"
                       IsClippedToBounds="True"
                       Padding="0"
                       BorderColor="#E8F0FE"
                       HorizontalOptions="Center">
                    <Image Source="{Binding ProfileImage, Converter={StaticResource Base64ToImageSourceConverter}}"
                           Aspect="AspectFill">
                        <Image.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ChangeProfilePictureCommand}"/>
                        </Image.GestureRecognizers>
                    </Image>
                </Frame>

                <!-- Basic Info -->
                <Entry Placeholder="Name"
                       Text="{Binding Name}"
                       Margin="0,10"/>

                <Entry Placeholder="Specialization"
                       Text="{Binding Specialization}"
                       Margin="0,10"/>

                <Editor Placeholder="Bio"
                        Text="{Binding Bio}"
                        HeightRequest="100"
                        Margin="0,10"/>

                <!-- Location Section -->
                <Frame Padding="15" 
                       Margin="0,10"
                       BorderColor="#E8F0FE"
                       BackgroundColor="White">
                    <VerticalStackLayout>
                        <Label Text="Location"
                               FontAttributes="Bold"
                               Margin="0,0,0,10"/>
                        <Label Text="{Binding Location}"
                               TextColor="#666666"/>
                        <Button Text="Set Location"
                                Command="{Binding OpenMapPickerCommand}"
                                BackgroundColor="#4B89DC"
                                TextColor="White"
                                Margin="0,10,0,0"/>
                    </VerticalStackLayout>
                </Frame>


                <!-- Availability Overview Section -->
                <!-- Availability Overview Section -->
                <Frame Margin="0,10" 
                   Padding="20"
                   BackgroundColor="White"
                   BorderColor="#E8F0FE"
                   CornerRadius="15"
                   HasShadow="True">
                    <VerticalStackLayout Spacing="15">
                        <Label Text="Next 30 Days Availability"
                           FontAttributes="Bold"
                           FontSize="18"
                           TextColor="#2B3A67"/>

                        <!-- Date Selection -->
                        <ScrollView Orientation="Horizontal"
                              HorizontalScrollBarVisibility="Never">
                            <HorizontalStackLayout Spacing="10">
                                <CollectionView ItemsSource="{Binding AvailableDates}"
                                          SelectionMode="Single">
                                    <CollectionView.ItemsLayout>
                                        <LinearItemsLayout Orientation="Horizontal"
                                                     ItemSpacing="10"/>
                                    </CollectionView.ItemsLayout>
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <Frame BackgroundColor="{Binding IsSelected, Converter={StaticResource BoolToColorConverter}}"
                                               Padding="15,10"
                                               CornerRadius="10"
                                               WidthRequest="100">
                                                <Frame.GestureRecognizers>
                                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.SelectDateCommand}"
                                                                    CommandParameter="{Binding}"/>
                                                </Frame.GestureRecognizers>
                                                <VerticalStackLayout Spacing="5">
                                                    <Label Text="{Binding Date, StringFormat='{0:MMM}'}"
                                                       FontSize="14"
                                                       TextColor="#666666"
                                                       HorizontalOptions="Center"/>
                                                    <Label Text="{Binding Date, StringFormat='{0:dd}'}"
                                                       FontSize="24"
                                                       FontAttributes="Bold"
                                                       TextColor="#2B3A67"
                                                       HorizontalOptions="Center"/>
                                                    <Label Text="{Binding Date, StringFormat='{0:ddd}'}"
                                                       FontSize="12"
                                                       TextColor="#666666"
                                                       HorizontalOptions="Center"/>
                                                </VerticalStackLayout>
                                            </Frame>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </HorizontalStackLayout>
                        </ScrollView>

                        <!-- Time Slots for Selected Date -->
                        <VerticalStackLayout IsVisible="{Binding SelectedDate, Converter={StaticResource NotNullConverter}}"
                                       Spacing="10">
                            <Label Text="Available Times"
                               FontAttributes="Bold"
                               FontSize="16"
                               TextColor="#2B3A67"/>

                            <CollectionView ItemsSource="{Binding SelectedDate.TimeSlots}">
                                <CollectionView.ItemsLayout>
                                    <GridItemsLayout Orientation="Vertical"
                                               Span="4"
                                               VerticalItemSpacing="10"
                                               HorizontalItemSpacing="10"/>
                                </CollectionView.ItemsLayout>
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Frame BackgroundColor="{Binding IsAvailable, Converter={StaticResource BoolToColorConverter}}"
                                           Padding="10"
                                           CornerRadius="8">
                                            <Frame.GestureRecognizers>
                                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ToggleTimeSlotCommand}"
                                                                CommandParameter="{Binding}"/>
                                            </Frame.GestureRecognizers>
                                            <Label Text="{Binding Time}"
                                               FontSize="14"
                                               TextColor="{Binding IsAvailable, Converter={StaticResource BoolToColorConverter}, ConverterParameter=text}"
                                               HorizontalOptions="Center"/>
                                        </Frame>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Frame>

                <!-- Action Buttons -->
                <StackLayout Orientation="Horizontal" 
                           Spacing="10"
                           Margin="0,20,0,0">
                    <Button Text="Save"
                            Command="{Binding SaveProfileCommand}"
                            BackgroundColor="#4B89DC"
                            TextColor="White"
                            HorizontalOptions="FillAndExpand"/>

                    <Button Text="Cancel"
                            Command="{Binding CancelEditCommand}"
                            BackgroundColor="#95A5A6"
                            TextColor="White"
                            HorizontalOptions="FillAndExpand"/>
                </StackLayout>
            </VerticalStackLayout>

            <!-- Profile Preview Mode -->
            <VerticalStackLayout IsVisible="{Binding HasProfile}">
                <!-- Your existing profile preview code -->
                <Frame Padding="20" 
                       BorderColor="#E8F0FE"
                       BackgroundColor="White">
                    <VerticalStackLayout>
                        <Frame HeightRequest="120" 
                               WidthRequest="120" 
                               CornerRadius="60"
                               IsClippedToBounds="True"
                               Padding="0"
                               BorderColor="#E8F0FE"
                               HorizontalOptions="Center">
                            <Image Source="{Binding ProfileImage, Converter={StaticResource Base64ToImageSourceConverter}}"
                                   Aspect="AspectFill"/>
                        </Frame>

                        <Label Text="{Binding Name}"
                               FontSize="24"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               Margin="0,10"/>

                        <Label Text="{Binding Specialization}"
                               FontSize="18"
                               TextColor="#666666"
                               HorizontalOptions="Center"/>

                        <Label Text="{Binding Bio}"
                               Margin="0,20"
                               TextColor="#666666"/>

                        <Label Text="{Binding Location}"
                               TextColor="#666666"/>

                    

                        <Button Text="Edit Profile"
                                Command="{Binding EditProfileCommand}"
                                BackgroundColor="#4B89DC"
                                TextColor="White"
                                Margin="0,20,0,0"/>

                        <Button Text="Delete Profile"
                                Command="{Binding DeleteProfileCommand}"
                                BackgroundColor="#FF4B4B"
                                TextColor="White"
                                Margin="0,10,0,0"/>
                    </VerticalStackLayout>
                </Frame>
            </VerticalStackLayout>


<!--MANAGE APPOINTMENTS-->
            <!-- Manage Appointments Button -->
            <Frame Margin="0,10" 
                   Padding="15" 
                   BackgroundColor="White"
                   BorderColor="#E8F0FE"
                   CornerRadius="15"
                   HasShadow="True">
                <Frame.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding ViewAppointmentsCommand}"/>
                </Frame.GestureRecognizers>
                <StackLayout>
                    <Label Text="Manage Appointments"
                           HorizontalOptions="CenterAndExpand"
                           TextColor="DarkBlue" 
                           FontSize="Medium"  
                           FontAttributes="Bold" />
                    <Image Source="appointments.png"/>
                </StackLayout>
            </Frame>




        </VerticalStackLayout>
     
    </ScrollView>
</ContentPage>