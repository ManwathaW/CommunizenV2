<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:CommuniZEN.Converters"
             x:Class="CommuniZEN.Views.PractitionerDashboardPage"
             BackgroundColor="#F5F9FF">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:Base64ToImageSourceConverter x:Key="Base64ToImageSourceConverter"/>
            <converters:BoolToColorConverter x:Key="BoolToColorConverter" 
                                           TrueColor="#4B89DC" 
                                           FalseColor="#F0F0F0"/>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">
            <!-- Profile Edit Mode -->
            <VerticalStackLayout IsVisible="{Binding IsEditing}">
                <!-- Profile Image Section -->
                <Frame HeightRequest="120" 
                       WidthRequest="120" 
                       CornerRadius="60"
                       IsClippedToBounds="True"
                       Padding="0"
                       BorderColor="#E8F0FE"
                       HorizontalOptions="Center">
                    <Image Source="{Binding ProfileImage, Converter={StaticResource Base64ToImageSourceConverter}}"
                           Aspect="AspectFill">
                        <Image.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ChangeProfilePictureCommand}"/>
                        </Image.GestureRecognizers>
                    </Image>
                </Frame>

                <!-- Basic Info -->
                <Entry Placeholder="Name"
                       Text="{Binding Name}"
                       Margin="0,10"/>

                <Entry Placeholder="Specialization"
                       Text="{Binding Specialization}"
                       Margin="0,10"/>

                <Editor Placeholder="Bio"
                        Text="{Binding Bio}"
                        HeightRequest="100"
                        Margin="0,10"/>

                <!-- Location Section -->
                <Frame Padding="15" 
                       Margin="0,10"
                       BorderColor="#E8F0FE"
                       BackgroundColor="White">
                    <VerticalStackLayout>
                        <Label Text="Location"
                               FontAttributes="Bold"
                               Margin="0,0,0,10"/>
                        <Label Text="{Binding Location}"
                               TextColor="#666666"/>
                        <Button Text="Set Location"
                                Command="{Binding OpenMapPickerCommand}"
                                BackgroundColor="#4B89DC"
                                TextColor="White"
                                Margin="0,10,0,0"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Availability Section -->
                <Frame Padding="15" 
                       Margin="0,10"
                       BorderColor="#E8F0FE"
                       BackgroundColor="White">
                    <VerticalStackLayout Spacing="15">
                        <Label Text="Working Days"
                               FontAttributes="Bold"/>

                        <!-- Days Selection -->
                        <CollectionView ItemsSource="{Binding WorkingDays}"
                                      HeightRequest="50">
                            <CollectionView.ItemsLayout>
                                <LinearItemsLayout Orientation="Horizontal" 
                                                 ItemSpacing="10"/>
                            </CollectionView.ItemsLayout>
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Frame BackgroundColor="{Binding IsSelected, Converter={StaticResource BoolToColorConverter}}"
                                           Padding="15,5"
                                           CornerRadius="10">
                                        <Frame.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ToggleDayCommand}"
                                                                CommandParameter="{Binding .}"/>
                                        </Frame.GestureRecognizers>
                                        <Label Text="{Binding DayName}"
                                               TextColor="{Binding IsSelected, Converter={StaticResource BoolToColorConverter}, ConverterParameter=text}"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center"/>
                                    </Frame>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>

                        <!-- Time Slots -->
                        <Label Text="Time Slots"
                               FontAttributes="Bold"
                               Margin="0,10,0,0"/>

                        <Grid ColumnDefinitions="*,Auto">
                            <Entry Placeholder="Add time (e.g. 09:00 - 10:00)"
                                   Text="{Binding NewTimeSlot}"/>
                            <Button Grid.Column="1"
                                    Text="Add"
                                    Command="{Binding AddTimeSlotCommand}"
                                    BackgroundColor="#4B89DC"
                                    TextColor="White"
                                    WidthRequest="80"/>
                        </Grid>

                        <CollectionView ItemsSource="{Binding TimeSlots}"
                                      HeightRequest="150">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="*,Auto" 
                                          Padding="5"
                                          Margin="0,5">
                                        <Label Text="{Binding Time}"
                                               VerticalOptions="Center"/>
                                        <Button Grid.Column="1"
                                                Text="Remove"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.RemoveTimeSlotCommand}"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="#FF4B4B"
                                                TextColor="White"
                                                HeightRequest="35"
                                                WidthRequest="80"/>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Frame>

                <!-- Action Buttons -->
                <StackLayout Orientation="Horizontal" 
                           Spacing="10"
                           Margin="0,20,0,0">
                    <Button Text="Save"
                            Command="{Binding SaveProfileCommand}"
                            BackgroundColor="#4B89DC"
                            TextColor="White"
                            HorizontalOptions="FillAndExpand"/>

                    <Button Text="Cancel"
                            Command="{Binding CancelEditCommand}"
                            BackgroundColor="#95A5A6"
                            TextColor="White"
                            HorizontalOptions="FillAndExpand"/>
                </StackLayout>
            </VerticalStackLayout>

            <!-- Profile Preview Mode -->
            <VerticalStackLayout IsVisible="{Binding HasProfile}">
                <!-- Your existing profile preview code -->
                <Frame Padding="20" 
                       BorderColor="#E8F0FE"
                       BackgroundColor="White">
                    <VerticalStackLayout>
                        <Frame HeightRequest="120" 
                               WidthRequest="120" 
                               CornerRadius="60"
                               IsClippedToBounds="True"
                               Padding="0"
                               BorderColor="#E8F0FE"
                               HorizontalOptions="Center">
                            <Image Source="{Binding ProfileImage, Converter={StaticResource Base64ToImageSourceConverter}}"
                                   Aspect="AspectFill"/>
                        </Frame>

                        <Label Text="{Binding Name}"
                               FontSize="24"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               Margin="0,10"/>

                        <Label Text="{Binding Specialization}"
                               FontSize="18"
                               TextColor="#666666"
                               HorizontalOptions="Center"/>

                        <Label Text="{Binding Bio}"
                               Margin="0,20"
                               TextColor="#666666"/>

                        <Label Text="{Binding Location}"
                               TextColor="#666666"/>

                        <!-- Working Hours Display -->
                        <Label Text="Available Times"
                               FontAttributes="Bold"
                               Margin="0,20,0,10"/>

                        <CollectionView ItemsSource="{Binding TimeSlots}"
                                      HeightRequest="100">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Label Text="{Binding Time}"
                                           Margin="0,5"/>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>

                        <Button Text="Edit Profile"
                                Command="{Binding EditProfileCommand}"
                                BackgroundColor="#4B89DC"
                                TextColor="White"
                                Margin="0,20,0,0"/>

                        <Button Text="Delete Profile"
                                Command="{Binding DeleteProfileCommand}"
                                BackgroundColor="#FF4B4B"
                                TextColor="White"
                                Margin="0,10,0,0"/>
                    </VerticalStackLayout>
                </Frame>
            </VerticalStackLayout>


<!--MANAGE APPOINTMENTS-->

            <Frame Margin="20,10" 
               Padding="15" 
               BackgroundColor="White"
               BorderColor="#E8F0FE"
               CornerRadius="15"
               HasShadow="True">

                <Frame.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding ViewAppointmentsCommand}"/>
                </Frame.GestureRecognizers>

                <StackLayout>
                     <Label Text="Manage Appointments"
                            HorizontalOptions="CenterAndExpand"
                            TextColor="DarkBlue" FontSize="Medium"  FontAttributes="Bold" />
                      <Image Source="appointments.png"/>
                    
                </StackLayout>

            </Frame>




        </VerticalStackLayout>
     
    </ScrollView>
</ContentPage>